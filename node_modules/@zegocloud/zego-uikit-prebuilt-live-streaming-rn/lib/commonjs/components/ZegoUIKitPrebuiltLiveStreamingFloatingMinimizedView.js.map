{"version":3,"names":["ZegoUIKitPrebuiltLiveStreamingFloatingMinimizedView","props","window","useWindowDimensions","width","height","borderRadius","left","top","showSoundWaveInAudioMode","isInit","setIsInit","useState","isVisable","setIsVisable","layout","setLayout","floatViewInfo","setFloatViewInfo","activeUserID","setActiveUserID","isMoving","setIsMoving","panResponder","PanResponder","create","onStartShouldSetPanResponder","evt","gestureState","onMoveShouldSetPanResponder","onPanResponderGrant","zloginfo","onPanResponderMove","Math","abs","dx","dy","newLeft","newTop","onPanResponderEnd","onPanResponderRelease","pressedHandle","callbackID","String","floor","random","layoutHandle","useCallback","e","x","y","nativeEvent","MinimizingHelper","getInstance","notifyMaximize","useEffect","onPrebuiltInit","onWindowMinimized","initConfig","getInitConfig","setIsMinimizeSwitch","onWindowMaximized","onEntryNormal","onActiveUserIDUpdate","position","display","panHandlers","styles","floatAudioView","StyleSheet","overflow","zIndex","shadowColor","shadowOffset","shadowOpacity","shadowRadius","elevation"],"sources":["ZegoUIKitPrebuiltLiveStreamingFloatingMinimizedView.tsx"],"sourcesContent":["import React, { useEffect, useState, useCallback, useRef } from 'react';\nimport {\n    View,\n    Text,\n    Image,\n    Animated,\n    PanResponder,\n    StyleSheet,\n    useWindowDimensions,\n} from 'react-native';\nimport { ZegoAudioVideoView } from '@zegocloud/zego-uikit-rn';\nimport MinimizingHelper from \"../services/minimizing_helper\";\nimport { zloginfo } from \"../utils/logger\";\n  \nexport default function ZegoUIKitPrebuiltLiveStreamingFloatingMinimizedView(props: any) {\n    const window = useWindowDimensions();\n    const {\n        width = 90,\n        height = 160,\n        borderRadius = 10,\n        left = window.width / 2 || 100,\n        top = 10,\n        showSoundWaveInAudioMode = true,\n    } = props;\n    const [isInit, setIsInit] = useState(false);\n    const [isVisable, setIsVisable] = useState(false);\n    const [layout, setLayout] = useState({\n        left,\n        top,\n    });\n    const [floatViewInfo, setFloatViewInfo] = useState({\n        width: 0, height: 0,\n    });\n    const [activeUserID, setActiveUserID] = useState('');\n    const [isMoving, setIsMoving] = useState(false);\n\n    const panResponder = PanResponder.create({\n        onStartShouldSetPanResponder: (evt, gestureState) => true,\n        onMoveShouldSetPanResponder: (evt, gestureState) => true,\n        onPanResponderGrant: (evt, gestureState) => {\n            zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderGrant gestureState', gestureState);\n            setIsMoving(false);\n        },\n        onPanResponderMove: (evt, gestureState) => {\n            // zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderMove layout', layout);\n            // zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderMove gestureState', gestureState);\n            if (\n                Math.abs(gestureState.dx) < 5 &&\n                Math.abs(gestureState.dy) < 5 &&\n                !isMoving\n            ) {\n                setIsMoving(false);\n            } else {\n                setIsMoving(true);\n                const newLeft = layout.left + gestureState.dx;\n                const newTop = layout.top + gestureState.dy;\n                if (newLeft >= (window.width - floatViewInfo.width) || newTop >= (window.height - floatViewInfo.height) || newLeft <= 0 || newTop <= 0) return;\n                setLayout({\n                    left: newLeft,\n                    top: newTop,\n                });\n            }\n        },\n        onPanResponderEnd: (evt, gestureState) => {\n            zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderEnd layout', layout);\n            zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderEnd gestureState', gestureState);\n        },\n        onPanResponderRelease: () => {\n            if (!isMoving) {\n                // Click\n                pressedHandle();\n            }\n            setIsMoving(false);\n        },\n    });\n\n    const callbackID = 'ZegoMinimizeRoom' + String(Math.floor(Math.random() * 10000));\n    \n    const layoutHandle = useCallback((e) => {\n        const  { x, y, width, height } = e.nativeEvent.layout;\n        zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] layoutHandle', x, y, width, height);\n        setFloatViewInfo({ width, height });\n    }, []);\n    const pressedHandle = async () => {\n        zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] pressedHandle');\n        MinimizingHelper.getInstance().notifyMaximize();\n    }\n\n    useEffect(() => {\n        MinimizingHelper.getInstance().onPrebuiltInit(callbackID, () => {\n            zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] init success');\n            setIsInit(true);\n        });\n        return () => {\n            MinimizingHelper.getInstance().onPrebuiltInit(callbackID);\n        };\n    }, []);\n    useEffect(() => {\n        if (isInit) {\n            MinimizingHelper.getInstance().onWindowMinimized(callbackID, () => {\n                setIsVisable(true);\n                const initConfig = MinimizingHelper.getInstance().getInitConfig();\n                const { onWindowMinimized } = initConfig;\n\n                if (typeof onWindowMinimized === 'function') {\n                    onWindowMinimized();\n                    MinimizingHelper.getInstance().setIsMinimizeSwitch(true);\n                }\n            });\n            MinimizingHelper.getInstance().onWindowMaximized(callbackID, () => {\n                setIsVisable(false);\n                const initConfig = MinimizingHelper.getInstance().getInitConfig();\n                const { onWindowMaximized } = initConfig;\n\n                if (typeof onWindowMaximized === 'function') {\n                    onWindowMaximized();\n                    MinimizingHelper.getInstance().setIsMinimizeSwitch(true);\n                }\n            });\n            MinimizingHelper.getInstance().onEntryNormal(callbackID, () => {\n                setIsVisable(false);\n            });\n            MinimizingHelper.getInstance().onActiveUserIDUpdate(callbackID, (activeUserID) => {\n                // zloginfo(`[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onActiveUserIDUpdate`, activeUserID);\n                setActiveUserID(activeUserID);\n            });\n        }\n        return () => {\n            MinimizingHelper.getInstance().onWindowMinimized(callbackID);\n            MinimizingHelper.getInstance().onWindowMaximized(callbackID);\n            MinimizingHelper.getInstance().onEntryNormal(callbackID);\n            MinimizingHelper.getInstance().onActiveUserIDUpdate(callbackID);\n        }\n    }, [isInit]);\n    return (\n        <Animated.View\n            style={[\n                { position: 'absolute', left: layout.left, top: layout.top },\n                { display: isVisable ? 'flex' : 'none' },\n            ]}\n            onLayout={layoutHandle}\n            {...panResponder.panHandlers}\n        >\n            <View\n                style={[\n                    styles.floatAudioView,\n                    {\n                        width,\n                        height,\n                        borderRadius,\n                    }\n                ]}\n            >\n                {\n                    activeUserID ? <ZegoAudioVideoView\n                        key={activeUserID}\n                        userID={activeUserID}\n                        showSoundWave={showSoundWaveInAudioMode}\n                    /> : <View />\n                }\n            </View>\n        </Animated.View>\n    );\n}\n\nconst styles = StyleSheet.create({\n    floatAudioView: {\n        overflow: 'hidden',\n        zIndex: 10000,\n        shadowColor: \"#000\",\n        shadowOffset: {\n            width: 0,\n            height: 2,\n        },\n        shadowOpacity: 0.25,\n        shadowRadius: 3.84,\n        elevation: 8\n    },\n});"],"mappings":"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"}