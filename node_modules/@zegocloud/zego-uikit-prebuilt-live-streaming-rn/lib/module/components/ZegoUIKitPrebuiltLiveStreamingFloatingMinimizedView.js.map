{"version":3,"names":["React","useEffect","useState","useCallback","View","Animated","PanResponder","StyleSheet","useWindowDimensions","ZegoAudioVideoView","MinimizingHelper","zloginfo","ZegoUIKitPrebuiltLiveStreamingFloatingMinimizedView","props","window","width","height","borderRadius","left","top","showSoundWaveInAudioMode","isInit","setIsInit","isVisable","setIsVisable","layout","setLayout","floatViewInfo","setFloatViewInfo","activeUserID","setActiveUserID","isMoving","setIsMoving","panResponder","create","onStartShouldSetPanResponder","evt","gestureState","onMoveShouldSetPanResponder","onPanResponderGrant","onPanResponderMove","Math","abs","dx","dy","newLeft","newTop","onPanResponderEnd","onPanResponderRelease","pressedHandle","callbackID","String","floor","random","layoutHandle","e","x","y","nativeEvent","getInstance","notifyMaximize","onPrebuiltInit","onWindowMinimized","initConfig","getInitConfig","setIsMinimizeSwitch","onWindowMaximized","onEntryNormal","onActiveUserIDUpdate","position","display","panHandlers","styles","floatAudioView","overflow","zIndex","shadowColor","shadowOffset","shadowOpacity","shadowRadius","elevation"],"sources":["ZegoUIKitPrebuiltLiveStreamingFloatingMinimizedView.tsx"],"sourcesContent":["import React, { useEffect, useState, useCallback, useRef } from 'react';\nimport {\n    View,\n    Text,\n    Image,\n    Animated,\n    PanResponder,\n    StyleSheet,\n    useWindowDimensions,\n} from 'react-native';\nimport { ZegoAudioVideoView } from '@zegocloud/zego-uikit-rn';\nimport MinimizingHelper from \"../services/minimizing_helper\";\nimport { zloginfo } from \"../utils/logger\";\n  \nexport default function ZegoUIKitPrebuiltLiveStreamingFloatingMinimizedView(props: any) {\n    const window = useWindowDimensions();\n    const {\n        width = 90,\n        height = 160,\n        borderRadius = 10,\n        left = window.width / 2 || 100,\n        top = 10,\n        showSoundWaveInAudioMode = true,\n    } = props;\n    const [isInit, setIsInit] = useState(false);\n    const [isVisable, setIsVisable] = useState(false);\n    const [layout, setLayout] = useState({\n        left,\n        top,\n    });\n    const [floatViewInfo, setFloatViewInfo] = useState({\n        width: 0, height: 0,\n    });\n    const [activeUserID, setActiveUserID] = useState('');\n    const [isMoving, setIsMoving] = useState(false);\n\n    const panResponder = PanResponder.create({\n        onStartShouldSetPanResponder: (evt, gestureState) => true,\n        onMoveShouldSetPanResponder: (evt, gestureState) => true,\n        onPanResponderGrant: (evt, gestureState) => {\n            zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderGrant gestureState', gestureState);\n            setIsMoving(false);\n        },\n        onPanResponderMove: (evt, gestureState) => {\n            // zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderMove layout', layout);\n            // zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderMove gestureState', gestureState);\n            if (\n                Math.abs(gestureState.dx) < 5 &&\n                Math.abs(gestureState.dy) < 5 &&\n                !isMoving\n            ) {\n                setIsMoving(false);\n            } else {\n                setIsMoving(true);\n                const newLeft = layout.left + gestureState.dx;\n                const newTop = layout.top + gestureState.dy;\n                if (newLeft >= (window.width - floatViewInfo.width) || newTop >= (window.height - floatViewInfo.height) || newLeft <= 0 || newTop <= 0) return;\n                setLayout({\n                    left: newLeft,\n                    top: newTop,\n                });\n            }\n        },\n        onPanResponderEnd: (evt, gestureState) => {\n            zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderEnd layout', layout);\n            zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onPanResponderEnd gestureState', gestureState);\n        },\n        onPanResponderRelease: () => {\n            if (!isMoving) {\n                // Click\n                pressedHandle();\n            }\n            setIsMoving(false);\n        },\n    });\n\n    const callbackID = 'ZegoMinimizeRoom' + String(Math.floor(Math.random() * 10000));\n    \n    const layoutHandle = useCallback((e) => {\n        const  { x, y, width, height } = e.nativeEvent.layout;\n        zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] layoutHandle', x, y, width, height);\n        setFloatViewInfo({ width, height });\n    }, []);\n    const pressedHandle = async () => {\n        zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] pressedHandle');\n        MinimizingHelper.getInstance().notifyMaximize();\n    }\n\n    useEffect(() => {\n        MinimizingHelper.getInstance().onPrebuiltInit(callbackID, () => {\n            zloginfo('[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] init success');\n            setIsInit(true);\n        });\n        return () => {\n            MinimizingHelper.getInstance().onPrebuiltInit(callbackID);\n        };\n    }, []);\n    useEffect(() => {\n        if (isInit) {\n            MinimizingHelper.getInstance().onWindowMinimized(callbackID, () => {\n                setIsVisable(true);\n                const initConfig = MinimizingHelper.getInstance().getInitConfig();\n                const { onWindowMinimized } = initConfig;\n\n                if (typeof onWindowMinimized === 'function') {\n                    onWindowMinimized();\n                    MinimizingHelper.getInstance().setIsMinimizeSwitch(true);\n                }\n            });\n            MinimizingHelper.getInstance().onWindowMaximized(callbackID, () => {\n                setIsVisable(false);\n                const initConfig = MinimizingHelper.getInstance().getInitConfig();\n                const { onWindowMaximized } = initConfig;\n\n                if (typeof onWindowMaximized === 'function') {\n                    onWindowMaximized();\n                    MinimizingHelper.getInstance().setIsMinimizeSwitch(true);\n                }\n            });\n            MinimizingHelper.getInstance().onEntryNormal(callbackID, () => {\n                setIsVisable(false);\n            });\n            MinimizingHelper.getInstance().onActiveUserIDUpdate(callbackID, (activeUserID) => {\n                // zloginfo(`[ZegoUIKitPrebuiltLiveAudioRoomFloatingMinimizedView] onActiveUserIDUpdate`, activeUserID);\n                setActiveUserID(activeUserID);\n            });\n        }\n        return () => {\n            MinimizingHelper.getInstance().onWindowMinimized(callbackID);\n            MinimizingHelper.getInstance().onWindowMaximized(callbackID);\n            MinimizingHelper.getInstance().onEntryNormal(callbackID);\n            MinimizingHelper.getInstance().onActiveUserIDUpdate(callbackID);\n        }\n    }, [isInit]);\n    return (\n        <Animated.View\n            style={[\n                { position: 'absolute', left: layout.left, top: layout.top },\n                { display: isVisable ? 'flex' : 'none' },\n            ]}\n            onLayout={layoutHandle}\n            {...panResponder.panHandlers}\n        >\n            <View\n                style={[\n                    styles.floatAudioView,\n                    {\n                        width,\n                        height,\n                        borderRadius,\n                    }\n                ]}\n            >\n                {\n                    activeUserID ? <ZegoAudioVideoView\n                        key={activeUserID}\n                        userID={activeUserID}\n                        showSoundWave={showSoundWaveInAudioMode}\n                    /> : <View />\n                }\n            </View>\n        </Animated.View>\n    );\n}\n\nconst styles = StyleSheet.create({\n    floatAudioView: {\n        overflow: 'hidden',\n        zIndex: 10000,\n        shadowColor: \"#000\",\n        shadowOffset: {\n            width: 0,\n            height: 2,\n        },\n        shadowOpacity: 0.25,\n        shadowRadius: 3.84,\n        elevation: 8\n    },\n});"],"mappings":"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"}